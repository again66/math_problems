<!-- pages/arithmetic/arithmetic.wxml -->
<view class="container">
  <!-- 配置面板 -->
  <text class="panel-title">
        共{{previewData.total}}题：(题目: 1-{{previewData.problemPages}}页, 答案: {{previewData.answerStartPage}}页起)
  </text>
  <view class='set-title'>
    <view class="panel-title">设置标题</view>
    <input value="{{config.title}}" bindinput="changeTitle"/>
  </view>


  <!-- 隐藏的canvas -->
  <view wx:if="{{showCanvas}}" style="position: fixed; left: -10000px; top: -10000px; width: 794px; height: 1123px;">
    <canvas 
      id="mathCanvas" 
      type="2d" 
      style="width: 794px; height: 1123px;"
    ></canvas>
  </view>

  <!-- 进度显示 -->
  <view wx:if="{{generatingImages}}" class="progress-section">
    <view class="progress-bar">
      <view class="progress-inner" style="width: {{imageProgress}}%"></view>
    </view>
    <text class="progress-text">生成进度: {{imageProgress}}%</text>
  </view>

  <!-- 生成的图片显示区域 -->
  <view wx:if="{{showGeneratedImages && generatedImages.length > 0}}" class="images-section">
    <view class="section-header">
      <text class="section-title">生成的图片 ({{generatedImages.length}}张)</text>
      <button class="action-btn small" bindtap="saveAllImagesToAlbum">
          保存全部
        </button>
    </view>

    <!-- 图片导航和显示 -->
    <view class="image-viewer">
      <!-- 图片导航 -->
      <view class="image-nav">
        <button class="nav-btn" bindtap="switchImage" data-direction="prev">◀ </button>
        <text class="nav-info">第 {{currentImageIndex + 1}} / {{generatedImages.length}} 张</text>
        <button class="nav-btn" bindtap="switchImage" data-direction="next"> ▶</button>
      </view>

      <!-- 当前图片显示 -->
      <view class="current-image-container">
        <image 
          src="{{generatedImages[currentImageIndex]}}" 
          class="current-image"
          mode="widthFix"
          bindtap="previewCurrentImage"
        />
        <view class="image-info">
          <text class="image-type">{{currentImageIndex < generatedImages.length / 2 ? '题目' : '答案'}}页</text>
          <text class="image-page">第 {{currentImageIndex % (generatedImages.length / 2) + 1}} 页</text>
        </view>
      </view>

      <!-- 图片操作按钮 -->
      <view class="image-actions">
        <button class="action-btn secondary" bindtap="saveCurrentImage">保存本张</button>
      </view>

      <!-- 缩略图导航 -->
      <view class="thumbnails">
        <view 
          wx:for="{{generatedImages}}" 
          wx:key="index"
          class="thumbnail-item {{index === currentImageIndex ? 'active' : ''}}"
          bindtap="goToImage"
          data-index="{{index}}"
        >
          <image src="{{item}}" class="thumbnail-image" mode="aspectFill" />
          <text class="thumbnail-label">{{index < generatedImages.length / 2 ? '题' : '答'}}{{index % (generatedImages.length / 2) + 1}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-bar">
    <button class="btn export-btn" bindtap="generateImages" loading="{{generatingImages}}">
      {{generatingImages ? '生成中...' : '生成A4图片'}}
    </button>
  </view>
</view>